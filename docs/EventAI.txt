=========================================
Event AI documentation
=========================================

Scriptdev2 Revision 220 introduces a new database defined AI named EventAI.
This system allows users to create new creature scripts entierly within the Database.
ScriptName must still be set to "mob_eventai" within the MaNGOS database creature_template.scriptname field.

-----------------------------------------
Basic Structure of EventAI
-----------------------------------------
Event AI follows a basic if (Event) then do {Action} format.
Below is a the list of current fields within the Eventai_scripts table.

(Field_Name                 Discription)
id                          This value is mearly an incrementing counter of the current Event number. Required for sql queries.
creature_id                 Creature id which this event should occur on.

event_type                  Type of event (See Event Types below)
event_inverse_phase_mask    Mask which phases this event should NOT trigger in*
event_chance                Percent chance of this event occuring (1 - 100)
event_param1                Variable for event (dependant on Event type)
event_param2
event_param3

action1_type                First Type of Action to take when event occurs (See Action Types below)
action1_param1              Variables used for Action1 (dependant on Action type)
action1_param2
action1_param3

action2_type                Second Type of Action to take when event occurs (See Action Types below)
action2_param1              Variables used for Action2 (dependant on Action type)
action2_param2
action2_param3

action3_type                Third Type of Action to take when event occurs (See Action Types below)
action3_param1              Variables used for Action3 (dependant on Action type)
action3_param2
action3_param3

All params are signed 32 bit values (+/- 2147483647). If param specifies time then time is in milliseconds. If param specifies percentage then percentages are value/100 (ex: if param = 500 then that means 500%, -50 = -50%)

*Phase mask is a bit mask of which phases this event should not trigger in. Example: Phase mask value of 12 (1100) would mean that this event would trigger 0, 1 and all other phases except for 2 and 3 (0 counts as the first phase). 
-----------------------------------------
Event Types
-----------------------------------------
Below is the list of current Event types that EventAI can handle.
Each event type has its own specific interpretation of the params that accompany it.
Params are always read from Param1, then Param2, then Param3.

(#   Internal Name               Pamarm usage                           Discription)
0    EVENT_T_TIMER_REPEAT        Time, Initial, Random                  Expires first at (Param2) and then every (Param1 + rand()%Param3) time. 
1    EVENT_T_TIMER_SINGLE        Time                                   Expires once every (Param1) per Reset.
2    EVENT_T_TIMER_OOC_REPEAT    Time, Initial, Random                  Expires first at (Param2) and then every (Param1 + rand()%Param3) time while not in combat. 
3    EVENT_T_TIMER_OOC_SINGLE    Time                                   Expires once every (Param1) while not in combat per Reset.
4    EVENT_T_HP_SINGLE           HPMax%, HPMin%, TimeUntilRepeat        Expires when HP is between (Param1) and (Param2). Will repeat every (Param3) or never repeat if Param3 = 0. 
5    EVENT_T_MANA_SINGLE         ManaMax%,ManaMin% TimeUntilRepeat      Expires once Mana% is between (Param1) and (Param2). Will repeat every (Param3) or never repeat if Param3 = 0. 
6    EVENT_T_AGGRO               NONE                                   Expires upon initial aggro (does not repeat). 
7    EVENT_T_KILL                TimeUntilRepeat                        Expires upon killing a player. Will always occur unless (Param1) is not 0 in which case will only occur every (Param1) milliseconds.
8    EVENT_T_DEATH               NONE                                   Expires upon Death. 
9    EVENT_T_EVADE               NONE                                   Expires upon creature EnterEvadeMode().
10   EVENT_T_SPELLHIT            SpellID, School, TimeUntilRepeat       Expires upon Spell hit. If (param1) is set will only expire on that spell. If (param2) will only expire on spells of that school. Will repeat every (Param2) or never repeat if Param2 = 0. 
11   EVENT_T_RANGE               MinDist, MaxDist, TimeUnitlRepeat      Expires when the highest threat target distance is greater than (Param1) and less than (Param2). Repeats every (Param3) or never if Param3 = 0.
12   EVENT_T_OOC_LOS             NoHostile, NoFriendly, TimeUntilRepeat Expires when a Player moves within visible distance to creature. Does not expire for Hostile Players if (Param1) is not 0. Does not expire for Friendly Players if (Param2) is not 0. Will repeat every (Param3) or never if Param3 = 0. Does not expire for creatures or pet or when the creature is in combat.
13   EVENT_T_SPAWNED             NONE                                   Expires at initial spawn and at creature respawn (useful for setting ranged movement type)
14   EVENT_T_TARGET_HP           HPMax%, HPMin%, TimeUntilRepeat        Expires when Current Target's HP is between (Param1) and (Param2). Will repeat every (Param3) or never repeat if Param3 = 0. 
15   EVENT_T_TARGET_CASTING      TimeUntilRepeat			Expires when the player is casting a spell. Will repeat every (Param1) or never repeat if Param1 = 0.

-----------------------------------------
Action Types
-----------------------------------------
Below is the list of current Action types that EventAI can handle.
Each event type has its own specific interpretation of the params that accompany it.
Params are always read from Param1, then Param2, then Param3.

(#   Internal Name                     Param usage                     Discription)
0    ACTION_T_NONE                     No action                       Does nothign
1    ACTION_T_SAY                      TextId                          Says text
2    ACTION_T_YELL                     TextId                          Yellls text
3    ACTION_T_TEXTEMOTE                TextId                          Text Emotes text
4    ACTION_T_SOUND                    SoundId                         Plays Sound
5    ACTION_T_EMOTE                    EmoteId                         Does emote
6    ACTION_T_RANDOM_SAY               TextId1, TextId2, TextId3       Says random text between 3 params*
7    ACTION_T_RANDOM_YELL              TextId1, TextId2, TextId3       Yells random text between 3 params*
8    ACTION_T_RANDOM_TEXTEMOTE         TextId1, TextId2, TextId3       Text Emotes random text between 3 params*
9    ACTION_T_RANDOM_SOUND             SoundId1, SoundId2, SoundId3    Plays random sound between 3 params*
10   ACTION_T_RANDOM_EMOTE             EmoteId1, EmoteId2, EmoteId3    Emotes random emote between 3 params
11   ACTION_T_CAST                     SpellId, Target, CastFlags      Casts spell (param1) on target type (param2). Uses Cast Flags (specified below target types)
12   ACTION_T_SUMMON                   CreatureID, Target, Duration    Summons creature (param1) to attack target (param2) for (param3) duration. Spawns on top of current creature. 
13   ACTION_T_THREAT_SINGLE_PCT        Threat%, Target                 Modifies threat by (param1) on target type (param2)
14   ACTION_T_THREAT_ALL_PCT           Threat%                         Modifies threat by (param1) on all targets (using -100% on all will result in full aggro dump)
15   ACTION_T_QUEST_EVENT              QuestID, Target                 Calls AreaExploredOrEventHappens with (param1) for target type (Param2)
16   ACTION_T_QUEST_CASTCREATUREGO     QuestID, SpellId, Target        Sends CastCreatureOrGo for Quest (param1) with SpellId (param2) for target (param3)
17   ACTION_T_SET_UNIT_FIELD           Field_Number, Value, Target     Sets Unit Field (param1) to Value (param2) on target type (param3)
18   ACTION_T_SET_UNIT_FLAG            Flags, Target                   Sets flag (flags can be binary OR together to modify multiple flags at once) on for Target type (param2)
19   ACTION_T_REMOVE_UNIT_FLAG         Flags, Target                   Removes flag (flags can be binary OR together to modify multiple flags at once) on for Target type (param2)
20   ACTION_T_AUTO_ATTACK              AllowAutoAttack                 0 = stop melee attack, anything else means continue attacking/allow melee attacking
21   ACTION_T_COMBAT_MOVEMENT          AllowCombatMovement             0 = stop combat based movement, anything else continue/allow combat based movement (targeted movement generator)
22   ACTION_T_SET_PHASE                Phase                           Sets the current phase to (param1)
23   ACTION_T_INC_PHASE                Value                           Increments the phase by (param1). May be negative to decrement phase but should not be 0.
24   ACTION_T_EVADE                    No Params                       Forces the creature to evade. Wiping all threat and dropping combat.
25   ACTION_T_FLEE                     No Params                       Causes the creature to flee. Please use this action instead of directly casting this spell so we may change this when a more correct approach is found.
26   ACTION_T_QUEST_EVENT_ALL          QuestId                         Calls AreaExploredOrEventHappens with (param1) for all players on the threat list
27   ACTION_T_CASTCREATUREGO_ALL       QuestId, SpellId                Calls CastedCreatureOrGo for all players on the threat list with QuestID(Param1) and SpellId(Param2)
28   ACTION_T_REMOVEAURASFROMSPELL     Target, Spellid                 Removes all auras on Target caused by Spellid
29   ACTION_T_RANGED_MOVEMENT          Distance, Angle                 Changes the movement generator type to a ranged type. Note: Default melee type can still be done with this. Specify 0 angle and 0 distance.
30   ACTION_T_RANDOM_PHASE             PhaseId1, PhaseId2, PhaseId3    Sets the phase to the id between 3 params*
31   ACTION_T_RANDOM_PHASE_RANGE       PhaseMin, PhaseMax              Sets the phase to a random id (Phase = PhaseMin + rnd % PhaseMin-PhaseMax). PhaseMax must be greater than PhaseMin.
32   ACTION_T_SUMMON                   CreatureID, Target, SummonID    Summons creature (param1) to attack target (param2) at location specified by EventAI_Summons (param3). 
33   ACTION_T_KILLED_MONSTER           CreatureID, Target              Calls KilledMonster (param1) for target of type (param2)

* = Use -1 to specify that if this param is picked to do nothing. Random is constant between actions within an event. So if you have a random Yell and a random Sound they will match up (ex: param2 with param2)
-----------------------------------------
Target Types
-----------------------------------------
Below is the list of current Target types that EventAI can handle.
Target types are used by certain actions and may effect actions differently

(#   Internal Name                      Discription)
0    TARGET_T_SELF                      Self cast
1    TARGET_T_HOSTILE                   Our current target (ie: highest aggro)
2    TARGET_T_HOSTILE_SECOND_AGGRO      Second highest aggro (generaly used for cleaves and some special attacks)
3    TARGET_T_HOSTILE_LAST_AGGRO        Dead last on aggro (no idea what this could be used for)
4    TARGET_T_HOSTILE_RANDOM            Just any random target on our threat list
5    TARGET_T_HOSTILE_RANDOM_NOT_TOP    Any random target except top threat
6    TARGET_T_ACTION_INVOKER            Unit who caused this Event to occur (only works for EVENT_T_AGGRO, EVENT_T_KILL, EVENT_T_DEATH, EVENT_T_SPELLHIT, EVENT_T_OOC_LOS)

-----------------------------------------
Cast Flags
-----------------------------------------
Below is the list of current Cast Flags that EventAI's spell casting can handle.
Cast flags are handled bitwise. Bit 0 is Interrupt Previous, bit 1 is triggered, etc.
So for example the number "3"(11 in binary) would mean that this cast has both CAST_INTURRUPT_PREVIOUS and CAST_TRIGGERED.

(bit#   Internal Name                  Discription)
0       CAST_INTURRUPT_PREVIOUS        Interrupts any previous spell casting (basicaly makes sure that this spell goes off)
1       CAST_TRIGGERED                 Forces the spell to be instant cast and require no mana/reagents.
2       CAST_FORCE_CAST                Forces spell to cast even if the target is possibly out of range or the creature is possibly out of mana
3       CAST_NO_MELEE_IF_OOM           Prevents creature from entering melee if out of mana or out of range
4       CAST_FORCE_TARGET_SELF         Forces the target to cast this spell on itself
